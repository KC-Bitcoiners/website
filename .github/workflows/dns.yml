name: staticS3Deploy

on:
  push:
    branches: ["master", "automation"]
  # schedule:
  #   - cron: "0 0 * * 1,3,6"

  # workflow_dispatch:
  #   inputs:
  #     env:
  #       required: true
  #       default: 'dev'
  #       type: choice
  #       options:
  #       - prod
  #       - dev

# permissions:
#   id-token: write # Required for OIDC authentication
#   contents: read # Required to checkout your repository code


jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: tf
        uses: hashicorp/setup-terraform@v3
      - run: cd terraform; terraform init

      - id: plan
        run: cd terraform; pwd; ls -lah; terraform plan -no-color --var-file=envs/prod.tfvars --var="api_key=${{ secrets.DREAMHOST_KEY }}"

      - run: echo ${{ steps.plan.outputs.stdout }}
      - run: echo ${{ steps.plan.outputs.stderr }}
      - run: echo ${{ steps.plan.outputs.exitcode }}
